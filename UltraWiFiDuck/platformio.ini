; ================================================================
; UltraWiFiDuck  – 100 % OFFLINE platformio.ini
;  • platform  pinned to stable espressif32@6.3.2
;  • all packages declared in platform_packages
; ================================================================

[platformio]
default_envs = esp32-s2-kaluga-4MB

[env]                       ; inherited by every board
platform          = espressif32@6.3.2
framework         = arduino

; --- packages that are ALREADY inside uwd_pio_offline ----------
platform_packages =
;     me-no-dev/AsyncTCP @ ^1.2.4
;     me-no-dev/ESPAsyncWebServer @ ^1.2.3
;     bblanchon/ArduinoJson @ ^6.22.1
   ; framework-arduinoespressif32 @ 3.20009.0
   ; tool-esptoolpy              @ 1.40501.0
   ; tool-scons                  @ 4.40801.0
   ; tool-cmake
   ; tool-ninja
   ; tool-mklittlefs
   ; toolchain-riscv32-esp       @ 8.4.0+2021r2-patch5
   ; toolchain-xtensa-esp32s2-elf @ 8.4.0+2021r2-patch57   ; <-- note the -elf suffix!

; ---------- generic build flags / libs --------------------------
build_flags =
    -D CORE_DEBUG_LEVEL=0
    -D CONFIG_ASYNC_TCP_MAX_ACK_TIME=5000
    -D CONFIG_ASYNC_TCP_PRIORITY=10
    -D CONFIG_ASYNC_TCP_QUEUE_SIZE=64
    -D CONFIG_ASYNC_TCP_RUNNING_CORE=1
    -D CONFIG_ASYNC_TCP_STACK_SIZE=8192
    -D USE_NIMBLE
    -fpermissive
build_unflags =
    -DCORE_ASYNC_TCP

lib_ignore =
    AsyncTCP
    ESPAsyncWebServer

lib_deps =
    ESPAsyncWebServer          ; already working
    AsyncTCP
    ArduinoJson
;     https://github.com/ESP32Async/AsyncTCP.git
;     https://github.com/ESP32Async/ESPAsyncWebServer.git
    https://github.com/adafruit/Adafruit_NeoPixel.git
lib_extra_dirs    = custom_usb_descriptors
lib_compat_mode   = strict
lib_ldf_mode      = deep+
;lib_ldf_mode      = chain
monitor_speed     = 115200
monitor_filters   = esp32_exception_decoder
; extra_scripts  = post:Scripts/extra_script.py   ; disabled for Docker path hygiene

; ====================== BOARDS  =================================
[env:esp32-s2-kaluga-4MB]
board                       = esp32-s2-kaluga-1
board_build.partitions       = partitions/no_ota_large_spiffs_4MB.csv
board_upload.flash_size      = 4MB
board_upload.maximum_size    = 4194304

; (all other board-env sections may follow unchanged)
